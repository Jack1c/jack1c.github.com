---
layout: post
title: HotSpot的基本架构
toc: true
cover: /img/cover/why-is-binary.png
tags: ['jvm','java性能优化权威指南']
category: Java
---

# HotSpot的基本架构
标签 : java性能优化权威指南 JVM概览

+ 垃圾收集器　
+ JIT编译器
+ HotSpot VM运行时.


> JIT编译器,垃圾收集器都是可拔插的

## HotSpot VM 运行时

作用:

+ 解析命令行选项解析
+ VM生命周期管理
+ 类加载
+ 字节码解释
+ 异常处理
+ 同步,线程管理
+ java本地接口,VM致命错误处理
+ C++(非java)堆管理 　

### 命令行选项
HotSpot VM运行时系统解析命令选项,并且据此配置HotSpot VM.
命令行分三类:

+ 标记选项(Standard Option)
Java Virtual Machine Specification 要求所有Java虚拟机都必须实现的选项.
在发行版之间保持稳定.

+ 非标准选项(Nonstandard Option)(前缀-X)
不保证,也不强制所有的JVM所以的实现都必须支持

+ 非稳定选项(Developer Option)(前缀-XX)
为了特定的需求而对JVM运行进行校正,可能需要有系统配置参数的权限.

命令行选项用于控制HotSpot VM的内部变量,每个变量都有默认值.
如果变量为布尔类型在命令上添加或者取得就可以控制这些变量.

### VM生命周期

HotSpot VM由启动器启动.(Unix/Linux 上为java,windows上为java,javaw).

启动器启动HotSpot VM执行操作 :
1. 解析命令行选项
2. 设置堆的大小和JIT编译器
3. 设置环境变量,如:LD_LIBRARY_PATH和CLASSPATH
4. 如果有`-jar`选项,启动器从指定的JAR的mainfest中查找Main-Class,否则从命令行读取Main-Class
5. 使用标准Java本地接口(Java Native Interface JNI)方法JNI_CreateJavaVM在创建的线程中创建 HotSpot VM.
6. 在创建并初始化HotSpot后加载Java Main-Class.
7. HotSpot VM通过JNI方法CallStaticVoidMathode 调用Java main方法,并将命令行会传入.

### VM类加载 
> 类加载 : 从类名,或者接口名映射到产生**类对象**的过程  
> 类加载由HotSpot VM和Java SE 类加载库公共同完成 

Hotspot VM负责解析常量池符号. 

1.类加载阶段 

![image.png-22.3kB][1]

+ 通过类名查找java类的二进制文件(二进制流). 
+ 创建这个类对应的`java.lang.Class`对象

> 如果没有找到java类或者接口的二进制文件 抛出`NoClassDefFound`
> 在加载类之前会先加载它所有的父类,和父接口.如果继承层次有错会抛出`ClassCircularityError` 

2.类加载委派 
类加载器在查找和加载某个类时,该类加载器








  [1]: http://static.zybuluo.com/jack4c/5akqj65mcgmbkaduwq9ttctg/image.png